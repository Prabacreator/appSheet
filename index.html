<!doctype html>
<html lang="en">
<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!-- css andc js bootstrap -->
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/sweetalert.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
  root{
    --bs-primary:#0d6efd;
    --bs-secondary:#6c757d;
    --bs-success:#198754;
    --bs-info:#0dcaf0;
    --bs-warning:#ffc107;
    --bs-danger:#dc3545;
    --bs-light:#f8f9fa;
    --bs-dark:#212529;
  }
  body {
  	font-weight: 300 !important;
  	background-imagecolor: rgba(0,0,0,175);
  	background-size: cover;
  	background-repeat: no-repeat;
  	background-attachment: fixed;
  }
  @media (min-width: 768px) {
    .container {	
    	max-width: 420px;
    }
  }
  .container{
    max-width: 41em;
  }
  .form-control,.fw-bold,.btn{
    text-transform: capitalize;
  }
  .logo{
    width: 21px;
    height: 21px;
    border-radius: 50px;
  }
  .table-responsive {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }
  table{
    width: 100%;
    table-layout: fixed;
    border-collapse: collapse; 
    text-transform: capitalize;
  }
  table th, table td{
    padding: 0.2rem 0.5rem;
    word-wrap: break-word;
  }
  thead th{
    text-align: center;
    vertical-align: middle;
    border: 0.5px solid#ccc;
  }
  tbody th,td{
    vertical-align: middle;
    border: 0.5px solid#ccc;
  }
  tbody tr:hover{
    color: #f00;
    background-color: #ccc;
  }
  tfoot th{
    padding-top: 1rem;
  }
</style>
</head>
<body class="d-flex h-100 text-center text-bg-light">
<div class="d-flex w-100 h-100 p-3 mx-auto flex-column">
  <header class="mb-auto">
    <ol class="list-group list-group-numbered shadow text-start p-2"></ol>
  </header>
  
  <main class="text-bg-light px-auto rounded border shadow">
    <div class="table-responsive p-2">
      <div class="d-flex justify-content-between align-items-start border-bottom p-2">
        <h2 class="fw-bold float-md-start mb-0"><img src="img/praba.jpg"  class="logo mb-1"/> job info</h2>
        <div id="timestamp" class="float-md-end mb-3" style="font-size:0.75rem"></div>
      </div>
      <div class="fw-bold person text-start p-2"></div>
      <table class="table table-sm"></table>
    </div>
    <div class="text-end m-2">
      <button type="submit" form="add" class="btn btn-sm btn-outline-dark shadow" onclick="printPDF()"><svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 -960 960 960" fill="currentColor"><path d="M360-460h40v-80h40q17 0 28.5-11.5T480-580v-40q0-17-11.5-28.5T440-660h-80v200Zm40-120v-40h40v40h-40Zm120 120h80q17 0 28.5-11.5T640-500v-120q0-17-11.5-28.5T600-660h-80v200Zm40-40v-120h40v120h-40Zm120 40h40v-80h40v-40h-40v-40h40v-40h-80v200ZM320-240q-33 0-56.5-23.5T240-320v-480q0-33 23.5-56.5T320-880h480q33 0 56.5 23.5T880-800v480q0 33-23.5 56.5T800-240H320Zm0-80h480v-480H320v480ZM160-80q-33 0-56.5-23.5T80-160v-560h80v560h560v80H160Zm160-720v480-480Z"/></svg>  cetak PDF</button>
    </div>
  </main>
  
  <footer class="mt-auto p-3">
    <button type="submit" form="add" class="btn btn-sm btn-outline-dark shadow" onclick="toggleModal('myModal','show')"><svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 -960 960 960" fill="currentColor"><path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h357l-80 80H200v560h560v-278l80-80v358q0 33-23.5 56.5T760-120H200Zm280-360ZM360-360v-170l367-367q12-12 27-18t30-6q16 0 30.5 6t26.5 18l56 57q11 12 17 26.5t6 29.5q0 15-5.5 29.5T897-728L530-360H360Zm481-424-56-56 56 56ZM440-440h56l232-232-28-28-29-28-231 231v57Zm260-260-29-28 29 28 28 28-28-28Z"/></svg>  Tambah Data</button>
  </footer>
</div>
  <div class="modal fade" id="myModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <form id="add" onsubmit="addData()" class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title fw-bold">Add Data</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body px-3">
          <input type="text" id="date" name="date" class="form-control form-control-sm text-center border-0" required>
          <div class="row">
            <div class="col">
              <label for="">Name</label>
              <input type="text" id="name" name="name" class="form-control form-control-sm" onclick="empty('name')" list="listname" required><datalist id="listname" ></datalist>
            </div>
            <div class="col py-2">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="work">
                <label class="form-check-label" for="">Worked</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="over">
                <label class="form-check-label" for="">Overtime</label>
              </div>
            </div>
          </div>
          <h5 class="fw-bold">Salary</h5>
          <div class="row">
            <div class="col-3 offset-1">
              <label class=" mb-1" for="">Daily</label>
              <label class=" mb-1" for="">Cash</label>
              <label class=" mb-1" for="">Debt</label>
            </div>
            <div class="col-8">
              <input type="number" id="daily" name="daily" class="form-control form-control-sm text-center mb-1" onclick="empty('daily')" value="0" list="cashday"/><datalist id="cashday"></datalist>
              <input type="number" id="cash" name="cash" class="form-control form-control-sm text-center mb-1" value="0" onclick="empty('cash')">
              <input type="number" id="debt" name="debt" class="form-control form-control-sm text-center mb-1" value="0" onclick="empty('debt')">
            </div>
          </div>
          <label for="">Description</label>
          <textarea name="desc" id="desc" class="form-control form-control-sm" onclick="empty('desc')" ></textarea>
        </div>
        <div class="modal-footer">
          <button id="del" type="reset" class="btn btn-sm btn-danger">Delete</button>
          <button type="submit" form="add" class="btn btn-sm btn-dark">Save Changes</button>
        </div>
      </form>
    </div>
  </div>

<script src="js/bootstrap.bundle.min.js"></script>
<script src="js/sweetalert.min.js"></script>
<script src="js/html2canvas.min.js"></script>
<script src="js/jspdf.umd.min.js"></script>
<script>
var dataStorage = JSON.parse(localStorage.getItem('dataStorage')) || [];
var editStorage = null;
document.querySelector('#timestamp').textContent = new Date().toLocaleString('id-ID', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });

function toggleModal(id, action, name) {
  var modal = action === 'show' ? new bootstrap.Modal(document.getElementById(id)) : bootstrap.Modal.getInstance(document.getElementById(id));
  if(action === 'show'){
    modal.show();
    document.getElementById('date').value = new Date().toLocaleString('id-ID',{day:'2-digit',month:'2-digit',year:'numeric'}).replace(/\//g, '-');
  } else if(action === 'hide'){
    modal.hide();
    document.getElementById('add').reset();
  } else if(name){
    document.getElementById('name').value = name;
  }
}

function empty(id){
  document.getElementById(id).value = null;
}

function getList(){
  var nameList = [];
  var paysList = [];
  var listgroup = document.querySelector('.list-group');
  var listname = document.querySelector('#listname');
  var cashday = document.querySelector('#cashday');
  [listgroup,listname, cashday].forEach(element => {
    element.innerHTML = '';
  });
  dataStorage.forEach((item, index) => {
    if (!nameList.includes(item.name)) {
      nameList.push(item.name);
      var listDiv = document.createElement('li');
      listDiv.className = 'list-group-item text-bg-light';
      listDiv.textContent = item.name;
      listDiv.onclick =()=> getData(item.name);
      listgroup.appendChild(listDiv);
      
      var one = document.createElement('option');
      one.textContent = item.name;
      listname.appendChild(one);
    };
    if (item.daily !== 0 && !paysList.includes(item.daily)) {
      paysList.push(item.daily);
      var two = document.createElement('option');
      two.textContent = item.daily;
      cashday.appendChild(two);
    };
  });
}getList()

function addData(){
  var name = document.getElementById('name').value;
  var date = document.getElementById('date').value;
  var work = document.getElementById('work').checked;
  var over = document.getElementById('over').checked;
  var daily = parseFloat(document.getElementById('daily').value);
  var cash = parseFloat(document.getElementById('cash').value);
  var debt = parseFloat(document.getElementById('debt').value);
  var desc = document.getElementById('desc').value;
  var save = { name,date,work,over,daily,cash,debt,desc };
  
  if (editStorage === null) {
    dataStorage.push(save);
  } else {
    dataStorage[editStorage] = save;
    editStorage = null;
  }
  localStorage.setItem('dataStorage', JSON.stringify(dataStorage));
  toggleModal('myModal', 'hide');
  getList();
  getData(name);
}

function getData(name) {
  var person = document.querySelector('.person');
  person.innerHTML = '';
  var data = dataStorage.filter(item => item.name === name);
  person.innerHTML =`
  <h5 class="fw-bold">${name}</h5>`;
  person.onclick =()=> getData(name);
  return getTable(data);
}

function getDay(index, name) {
  var person = document.querySelector('.person');
  person.innerHTML = '';
  var filteredData = dataStorage.filter(item => item.name === name);
  var data = filteredData.slice(index, index + 7);
  person.innerHTML =`
  <h5 class="fw-bold" onclick="getData(${name})">${name}</h5>`;
  person.onclick =()=> getData(name);
  return getTable(data);
}

function getTable(data){
  var table = document.querySelector('table');
  table.innerHTML = '';
  
  var thead = document.createElement('thead');
  thead.innerHTML = `
  <tr style="font-size:0.5rem">
    <th rowspan="2">No</th>
    <th rowspan="2">tanggal</th>
    <th colspan="2">status</th>
    <th colspan="3">upah (gaji)</th>
  </tr><tr style="font-size:0.3rem">
    <th>bekerja</th>
    <th>lembur</th>
    <th>perhari</th>
    <th>dibayar</th>
    <th>Kasbon</th>
  </tr>`;
  table.appendChild(thead);
  data.forEach((item, idx) => {

    var tbody = document.createElement('tbody');
    tbody.innerHTML = ` 
    <tr style="background-color: ${item.cash > 0 ? '#a3cfbb' : ''};font-size:0.5rem;">
      <th class="text-center" onclick="setData(${idx})">${idx + 1}</th>
      <td class="text-center" onclick="getDay(${idx}, '${item.name}')">${item.date}</td>
      <td class="text-center"><input class="form-check-input" type="checkbox" ${item.work ? 'checked' : ''} ></td>
      <td class="text-center"><input class="form-check-input" type="checkbox" ${item.over ? 'checkbox' : 'hidden'}" ${item.over ? 'checked' : ''} ${item.over > 0 ? `onclick="getInfo('${item.desc}')"`: ''}></td>
      <th class="text-end" style="color: ${item.daily > 0 ? '#212529' : 'transparent'}">${item.daily}</th>
      <th class="text-end" style="background-color: ${item.cash > 0 ? '#a3cfbb' : ''};color: ${item.cash > 0 ? '#212529' : 'transparent'}" ${item.cash > 0 ? `onclick="getInfo('${item.desc}')"`: ''}>${item.cash}</th>
      <th class="text-end" style="background-color: ${item.debt > 0 ? '#f1aeb5' : ''};color: ${item.debt > 0 ? '#212529' : 'transparent'}" ${item.debt > 0 ? `onclick="getInfo('${item.desc}')"`: ''}>${item.debt}</th>
    </tr>`;
    table.appendChild(tbody);
  });
  var tfoot = document.createElement('tfoot');
  tfoot.innerHTML = `
    <tr class="text-center" style="font-size:0.5rem">
      <th colspan="2"></th>
      <th>${data.filter(item => item.work > 0).length}</th>
      <th>${data.filter(item => item.over > 0).length}</th>
      <th class="text-end">${data.reduce((sum, item) => sum + item.daily, 0)}</th>
      <th class="text-end">${data.reduce((sum, item) => sum + item.daily, 0) - (data.reduce((sum, item) => sum + item.cash, 0)+data.reduce((sum, item) => sum + item.debt, 0))}</th>
      <th class="text-end">${data.reduce((sum, item) => sum + item.debt, 0)}</th>
    </tr>`;
  table.appendChild(tfoot);
}

function getDay(index, name) {
  var start = index;
  var finish = index + 7;
  var filteredData = dataStorage.filter(item => item.name === name);
  var data = filteredData.slice(start, finish);
  return getTable(data);
}

function getInfo(index){
  Swal.fire({ text: index, showConfirmButton: true })
}

function setData(index) {
  editStorage = index;
  toggleModal('myModal', 'show');
  var item = dataStorage[index];
  document.getElementById('name').value = item.name;
  document.getElementById('date').value = item.date;
  document.getElementById('work').checked = item.work;
  document.getElementById('over').checked = item.over;
  document.getElementById('daily').value = item.daily;
  document.getElementById('cash').value = item.cash;
  document.getElementById('debt').value = item.debt;
  document.getElementById('desc').value = item.desc;
  document.querySelector('#del').addEventListener('click', function(){
    delData(index);
    getData(item.name);
  });
}

function delData(index) {
  dataStorage.splice(index, 1);
  localStorage.setItem('dataStorage', JSON.stringify(dataStorage));
  toggleModal('myModal', 'hide');
  getList();
}

function printPDF() {
  var main = document.querySelector('.table-responsive');
  html2canvas(main).then(function(canvas) {
    var imgData = canvas.toDataURL('image/png');
    var doc = new jspdf.jsPDF('p', 'mm', 'a4');
    doc.addImage(imgData, 'PNG', 10, 10, 190, 0);
    Swal.fire({
      title: 'File PDF',
      text: 'Yakin ingin menyimpan ?',
      icon: 'question',
      showCancelButton: true,
      confirmButtonText: 'Ya, Simpan',
      cancelButtonText: 'Tidak'
    }).then((result) => {
      if (result.isConfirmed) {
        var blob = doc.output('blob');
        var link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'Job-Info.pdf';
        link.click();
      }
    })
  });
}
</script>
</body>
</html>